(()=>{var e={735:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#avatar"),r=document.querySelector(".ad-form-header__preview img"),o=document.querySelector("#images"),n=document.querySelector(".ad-form__photo-container .ad-form__photo"),a=t=>{const r=t.name.toLowerCase();return e.some((e=>r.endsWith(e)))};t.addEventListener("change",(()=>{const e=t.files[0];if(a(e)){const t=new FileReader;t.addEventListener("load",(()=>{r.src=t.result})),t.readAsDataURL(e)}})),o.addEventListener("change",(()=>{const e=o.files[0];if(a(e)){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");e.src=t.result,e.width=70,e.height=70,e.alt="Фотография жилья",n.appendChild(e)})),t.readAsDataURL(e)}}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{"use strict";const e=(e,t=" ")=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t),t="success",o="error";let n;const a=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),i())},c=()=>i(),s=(e="success")=>{const t=document.querySelector(`#${e}`).content.querySelector(`.${e}`).cloneNode(!0);document.body.appendChild(t),n=t,document.addEventListener("keydown",a),document.addEventListener("click",c),e===o&&t.querySelector(`.${e}__button`).addEventListener("click",c)},i=()=>{n.className===o&&n.querySelector(".error__button").removeEventListener("click",c),n.remove(),document.removeEventListener("keydown",a),document.removeEventListener("click",c)},d=()=>s(o);r(735);const l="Произошла ошибка. Объявления не были загружены.",u="Пожалуйста, заполните это поле",p=1e6,f={bungalow:0,flat:1e3,house:5e3,palace:1e4},m={1:[1],2:[1,2],3:[1,2,3],NO_GUESTS:[0],ERR_CAPACITY:"1 комната — «для 1 гостя»;\n  2 комнаты — «для 2 гостей» или «для 1 гостя»;\n  3 комнаты — «для 3 гостей», «для 2 гостей» или «для 1 гостя»;\n  100 комнат — «не для гостей»"},_=document.querySelector(".ad-form"),y=_.querySelector("#title"),E=_.querySelector("#type"),h=_.querySelector("#price"),v=_.querySelector("#timein"),S=_.querySelector("#timeout"),g=_.querySelector("#room_number"),C=_.querySelector("#capacity");let O=p;O>h.max&&(O=h.max);let N=0;h.min<N&&(N=h.min);const I=()=>{N=f[E.value],h.placeholder=e(N),h.min=N},q=(e=v,t=S)=>{for(let r of t.options)r.selected=e.value===r.value},b=t=>{let r="";switch(t){case y:r=(()=>{const e=y.validity;let t="";return e.valueMissing?t=u:e.tooShort&&(t="Пожалуйста, удлините этот текст до {MIN_LEN} или {MAX_LEN} символов (в настоящее время вы используете {CUR_LEN} симв.).".replace("{MIN_LEN}",30).replace("{MAX_LEN}",100).replace("{CUR_LEN}",y.value.length)),t})();break;case h:r=(()=>{const t=h.validity;let r="";return t.valueMissing?r=u:t.rangeUnderflow?r="Значение должно быть больше или равно {MIN_PRICE}".replace("{MIN_PRICE}",e(N)):t.rangeOverflow&&(r="Значение должно быть меньше или равно {MAX_PRICE}".replace("{MAX_PRICE}",e(O))),r})();break;case C:r=(()=>{const e=Number(g.options[g.selectedIndex].value),t=m[e]||m.NO_GUESTS,r=Number(C.options[C.selectedIndex].value);return t.includes(r)})()?"":m.ERR_CAPACITY;break;default:r="unknown error"}return r},A=e=>e.target.reportValidity(),k=e=>e.target.setCustomValidity(b(e.target)),R=A,x=k,T=()=>{I(),h.reportValidity()},M=A,P=k,w=()=>{C.setCustomValidity(b(C)),C.reportValidity()},U=()=>{C.setCustomValidity(b(C)),C.reportValidity()},V=k,Y=()=>q(),D=()=>q(S,v),F={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало"},K=document.querySelector("#card").content.querySelector(".popup"),$=document.createElement("span");$.textContent=" ₽/ночь";const j=e=>e.classList.add("hidden"),X={TOKYO:[35.658581,139.745438],MAX_ZOOM_LEVEL:10,CANVAS_ID:"map-canvas",MAIN_PIN_URL:"img/main-pin.svg",MAIN_ICON_SIZE:[52,52],MAIN_ICON_ANCHOR:[26,52],PIN_URL:"img/pin.svg",ICON_SIZE:[40,40],ICON_ANCHOR:[20,40],PRECISION:5},Z=()=>!0,G={TYPE:"housing-type",PRICE:"housing-price",ROOMS:"housing-rooms",GUESTS:"housing-guests",FEATURES:"housing-features"},z={[G.TYPE]:Z,[G.PRICE]:Z,[G.ROOMS]:Z,[G.GUESTS]:Z,[G.FEATURES]:Z},H=Object.values(G),B={low:[0,1e4],middle:[1e4,5e4],high:[5e4,p]},W=document.querySelector(".ad-form"),J=document.querySelector(".map__filters"),Q=W.querySelector("#address"),ee=W.querySelector(".ad-form__reset"),te=J.querySelectorAll(".map__features .map__checkbox"),re=L.icon({iconUrl:X.MAIN_PIN_URL,iconSize:X.MAIN_ICON_SIZE,iconAnchor:X.MAIN_ICON_ANCHOR}),oe=L.marker(X.TOKYO,{icon:re,draggable:!0}),ne=L.icon({iconUrl:X.PIN_URL,iconSize:X.ICON_SIZE,iconAnchor:X.ICON_ANCHOR});let ae,ce;const se=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>t.remove()),5e3)},ie=(e=!0)=>{e?W.classList.add("ad-form--disabled"):W.classList.remove("ad-form--disabled"),W.querySelector(".ad-form-header").disabled=e,W.querySelectorAll(".ad-form__element").forEach((t=>t.disabled=e))},de=(e=!0)=>{e?J.classList.add("map__filters--disabled"):J.classList.remove("map__filters--disabled"),J.querySelector(".map__features").disabled=e,J.querySelectorAll(".map__filter").forEach((t=>t.disabled=e))},le=(e=X.TOKYO)=>Q.value=e.join(", "),ue=()=>{fe(),ie(!1),ye()},pe=e=>{const t=e.target.getLatLng();le([t.lat.toFixed(X.PRECISION),t.lng.toFixed(X.PRECISION)])},fe=()=>{oe.addTo(ae),oe.on("moveend",pe),le(X.TOKYO)},me=e=>H.every((t=>z[t](e))),_e=t=>{ce?ce.clearLayers():ce=L.layerGroup(),t.filter(me).slice(0,10).forEach((t=>{const r=L.marker([t.location.lat,t.location.lng],{icon:ne});r.bindPopup((t=>{const r=K.cloneNode(!0),o=r.querySelector(".popup__text--price"),n=r.querySelector(".popup__features"),a=n.querySelectorAll(".popup__feature"),c=r.querySelector(".popup__photos"),s=c.querySelector(".popup__photo"),i=document.createDocumentFragment(),d=r.querySelector(".popup__title"),l=r.querySelector(".popup__text--address"),u=r.querySelector(".popup__type"),p=r.querySelector(".popup__text--capacity"),f=r.querySelector(".popup__text--time"),m=r.querySelector(".popup__description"),_=r.querySelector(".popup__avatar");return t.offer.title?d.textContent=t.offer.title:j(d),t.offer.address?l.textContent=t.offer.address:j(l),"price"in t.offer?(o.textContent=e(t.offer.price),o.appendChild($.cloneNode(!0))):j(o),t.offer.type?u.textContent=F[t.offer.type]:j(u),t.offer.rooms||t.offer.guests?p.textContent=`${t.offer.rooms} комнаты для ${t.offer.guests} гостей`:j(p),t.offer.checkin||t.offer.checkout?f.textContent=`Заезд после ${t.offer.checkin}, выезд до ${t.offer.checkout}`:j(f),t.offer.features&&t.offer.features.length?(a.forEach((e=>j(e))),t.offer.features.forEach((e=>r.querySelector(`.popup__feature--${e}`).classList.remove("hidden")))):j(n),t.offer.description?m.textContent=t.offer.description:j(m),t.offer.photos&&t.offer.photos.length?(t.offer.photos.forEach((e=>{const t=s.cloneNode(!1);t.src=e,i.appendChild(t)})),s.remove(),c.appendChild(i)):j(c),t.author.avatar?_.src=t.author.avatar:j(_),r})(t)),ce.addLayer(r)})),ce.addTo(ae)},ye=()=>{var e,t;e=e=>{_e(e),de(!1),J.addEventListener("reset",(()=>{H.forEach((e=>z[e]=Z)),_e(e)})),J.addEventListener("change",((e,t=100)=>{let r;return(...o)=>{r&&clearTimeout(r),r=setTimeout((()=>{e(...o),r=null}),t)}})((t=>{ae.closePopup(),(e=>{let t,r;"checkbox"===e.target.type?(t=G.FEATURES,r=(()=>{const e=[];for(const t of te)t.checked&&e.push(t.value);return e})()):(t=e.target.id,r=e.target.options[e.target.selectedIndex].value),z[t]=((e,t)=>{let r=Z;if("any"===t)return r;switch(e){case G.TYPE:r=({offer:e})=>e.type===t;break;case G.PRICE:t in B&&(r=({offer:e})=>e.price>=B[t][0]&&e.price<B[t][1]);break;case G.ROOMS:r=({offer:e})=>e.rooms===Number(t);break;case G.GUESTS:r=({offer:e})=>e.guests===Number(t);break;case G.FEATURES:r=({offer:e})=>{try{return t.every((t=>e.features.includes(t)))}catch(e){}return!1}}return r})(t,r)})(t),_e(e)}),500))},t=se,fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();t(l)})).then((t=>e(t))).catch((()=>t(l)))},Ee=()=>{W.reset(),J.reset(),ae.closePopup(),oe.setLatLng(X.TOKYO),le(X.TOKYO),ae.flyTo(X.TOKYO,X.MAX_ZOOM_LEVEL)},he=e=>{e.preventDefault(),Ee()};document.addEventListener("DOMContentLoaded",(()=>{var e,r;ie(!0),de(!0),ae=L.map(X.CANVAS_ID),ae.on("load",ue),ae.setView(X.TOKYO,X.MAX_ZOOM_LEVEL),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(ae),ee.addEventListener("click",he),e=()=>{Ee(),s(t)},r=d,_.addEventListener("submit",(t=>{t.preventDefault(),((e,t,r)=>{fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((r=>{r.ok?e():t()})).catch(t)})(e,r,new FormData(_))})),I(),y.addEventListener("input",R),y.addEventListener("invalid",x),E.addEventListener("change",T),h.addEventListener("input",M),h.addEventListener("invalid",P),g.addEventListener("change",w),C.addEventListener("change",U),C.addEventListener("invalid",V),v.addEventListener("change",Y),S.addEventListener("change",D)}))})()})();
//# sourceMappingURL=main.bundle.js.map